# –ê–Ω–∞–ª–∏–∑ –∫–æ–¥–∞ –∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –ø–æ —É–ª—É—á—à–µ–Ω–∏—é

## üîç –ù–∞–π–¥–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ –æ—à–∏–±–∫–∏

### 1. **–ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–†–û–ë–õ–ï–ú–´**

#### 1.1. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ null/undefined –¥–ª—è currentUserId
**–ú–µ—Å—Ç–æ:** –°—Ç—Ä–æ–∫–∞ 2146
```javascript
const currentUserId = {% if user and user.id %}{{ user.id }}{% else %}null{% endif %};
```
**–ü—Ä–æ–±–ª–µ–º–∞:** –ï—Å–ª–∏ `user.id` —Ä–∞–≤–µ–Ω 0, —É—Å–ª–æ–≤–∏–µ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç, –∏ `currentUserId` –±—É–¥–µ—Ç `null`
**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å —è–≤–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É –Ω–∞ `null` –∏ `undefined`

#### 1.2. –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è —É—Ç–µ—á–∫–∞ –ø–∞–º—è—Ç–∏ –≤ Set
**–ú–µ—Å—Ç–æ:** `locallyTakenChats` (—Å—Ç—Ä–æ–∫–∞ 2105)
**–ü—Ä–æ–±–ª–µ–º–∞:** Set –º–æ–∂–µ—Ç —Ä–∞—Å—Ç–∏ –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ, –µ—Å–ª–∏ —á–∞—Ç—ã –Ω–µ —É–¥–∞–ª—è—é—Ç—Å—è –∏–∑ –Ω–µ–≥–æ
**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –æ—á–∏—Å—Ç–∫—É —Å—Ç–∞—Ä—ã—Ö –∑–∞–ø–∏—Å–µ–π

#### 1.3. Race condition –ø—Ä–∏ batch-take
**–ú–µ—Å—Ç–æ:** `flushBatchTakeQueue` (—Å—Ç—Ä–æ–∫–∞ 4518)
**–ü—Ä–æ–±–ª–µ–º–∞:** –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –±—ã—Å—Ç—Ä–æ –±–µ—Ä–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ —á–∞—Ç–æ–≤, –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å –±–ª–æ–∫–∏—Ä–æ–≤–∫—É –Ω–∞ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞

### 2. **–°–†–ï–î–ù–ò–ï –ü–†–û–ë–õ–ï–ú–´**

#### 2.1. –ò–∑–±—ã—Ç–æ—á–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ production
**–ú–µ—Å—Ç–æ:** –ú–Ω–æ–∂–µ—Å—Ç–≤–æ `console.log` –≤ –∫–æ–¥–µ
**–ü—Ä–æ–±–ª–µ–º–∞:** –ó–∞–º–µ–¥–ª—è–µ—Ç —Ä–∞–±–æ—Ç—É –≤ production
**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `DEBUG_MODE` —Ñ–ª–∞–≥ –¥–ª—è –≤—Å–µ—Ö –ª–æ–≥–æ–≤

#### 2.2. –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ "–ú–æ–∏ —á–∞—Ç—ã"
**–ú–µ—Å—Ç–æ:** –ú–Ω–æ–∂–µ—Å—Ç–≤–æ –º–µ—Å—Ç —Å –æ–¥–∏–Ω–∞–∫–æ–≤–æ–π –ª–æ–≥–∏–∫–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏
**–ü—Ä–æ–±–ª–µ–º–∞:** –°–ª–æ–∂–Ω–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å
**–†–µ—à–µ–Ω–∏–µ:** –í—ã–Ω–µ—Å—Ç–∏ –≤ –æ—Ç–¥–µ–ª—å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é

#### 2.3. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ —Å–µ—Ç–∏
**–ú–µ—Å—Ç–æ:** `loadChats`, `flushBatchTakeQueue`
**–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–∏ –ø–æ—Ç–µ—Ä–µ —Å–µ—Ç–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –º–æ–∂–µ—Ç –∑–∞–≤–∏—Å–Ω—É—Ç—å
**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å retry –ª–æ–≥–∏–∫—É –∏ –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫

#### 2.4. –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞ —Å –∫–µ—à–µ–º
**–ú–µ—Å—Ç–æ:** `saveChatsToCache` (—Å—Ç—Ä–æ–∫–∞ 2112)
**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–µ—à –º–æ–∂–µ—Ç –±—ã—Ç—å —É—Å—Ç–∞—Ä–µ–≤—à–∏–º –ø–æ—Å–ª–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è —á–∞—Ç–æ–≤
**–†–µ—à–µ–Ω–∏–µ:** –ò–Ω–≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å –∫–µ—à –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π

### 3. **–ú–ï–õ–ö–ò–ï –ü–†–û–ë–õ–ï–ú–´**

#### 3.1. –ú–∞–≥–∏—á–µ—Å–∫–∏–µ —á–∏—Å–ª–∞
**–ú–µ—Å—Ç–æ:** –†–∞–∑–±—Ä–æ—Å–∞–Ω—ã –ø–æ –∫–æ–¥—É (2000, 3000, 5000 –∏ —Ç.–¥.)
**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ–ø–æ–Ω—è—Ç–Ω–æ, —á—Ç–æ –æ–∑–Ω–∞—á–∞—é—Ç
**–†–µ—à–µ–Ω–∏–µ:** –í—ã–Ω–µ—Å—Ç–∏ –≤ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã —Å –ø–æ–Ω—è—Ç–Ω—ã–º–∏ –∏–º–µ–Ω–∞–º–∏

#### 3.2. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö
**–ú–µ—Å—Ç–æ:** –ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö —Å —Å–µ—Ä–≤–µ—Ä–∞
**–ü—Ä–æ–±–ª–µ–º–∞:** –ú–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –æ—à–∏–±–∫–∞–º –ø—Ä–∏ –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ
**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö

## üöÄ –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –ø–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### 1. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**

#### 1.1. –í–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏—è —Å–ø–∏—Å–∫–∞ —á–∞—Ç–æ–≤
**–¢–µ–∫—É—â–∞—è –ø—Ä–æ–±–ª–µ–º–∞:** –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –≤—Å–µ—Ö —á–∞—Ç–æ–≤ —Å—Ä–∞–∑—É –º–æ–∂–µ—Ç –±—ã—Ç—å –º–µ–¥–ª–µ–Ω–Ω—ã–º
**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏—é (–Ω–∞–ø—Ä–∏–º–µ—Ä, react-window –∏–ª–∏ vue-virtual-scroller)
**–≠—Ñ—Ñ–µ–∫—Ç:** –£–ª—É—á—à–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –ø—Ä–∏ –±–æ–ª—å—à–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ —á–∞—Ç–æ–≤

#### 1.2. Debounce –¥–ª—è –ø–æ–∏—Å–∫–∞
**–¢–µ–∫—É—â–∞—è –ø—Ä–æ–±–ª–µ–º–∞:** `SEARCH_DEBOUNCE = 0` –æ–∑–Ω–∞—á–∞–µ—Ç –º–≥–Ω–æ–≤–µ–Ω–Ω—ã–π –ø–æ–∏—Å–∫
**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å debounce 300-500ms
**–≠—Ñ—Ñ–µ–∫—Ç:** –ú–µ–Ω—å—à–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ –±—Ä–∞—É–∑–µ—Ä

#### 1.3. Lazy loading –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
**–¢–µ–∫—É—â–∞—è –ø—Ä–æ–±–ª–µ–º–∞:** –í—Å–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —Å—Ä–∞–∑—É
**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `loading="lazy"` –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
**–≠—Ñ—Ñ–µ–∫—Ç:** –ë—ã—Å—Ç—Ä–µ–µ –∑–∞–≥—Ä—É–∑–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã

#### 1.4. –ú–µ–º–æ–∏–∑–∞—Ü–∏—è –≤—ã—á–∏—Å–ª–µ–Ω–∏–π
**–¢–µ–∫—É—â–∞—è –ø—Ä–æ–±–ª–µ–º–∞:** –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –∫–∞–∂–¥—ã–π —Ä–∞–∑
**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–µ–º–æ–∏–∑–∞—Ü–∏—é –¥–ª—è –¥–æ—Ä–æ–≥–∏—Ö –≤—ã—á–∏—Å–ª–µ–Ω–∏–π
**–≠—Ñ—Ñ–µ–∫—Ç:** –ú–µ–Ω—å—à–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏–π –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –≤—ã–∑–æ–≤–∞—Ö

### 2. **UX —É–ª—É—á—à–µ–Ω–∏—è**

#### 2.1. –û–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:** –ß–∞—Å—Ç–∏—á–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ
**–£–ª—É—á—à–µ–Ω–∏–µ:** –†–∞—Å—à–∏—Ä–∏—Ç—å –Ω–∞ –≤—Å–µ –¥–µ–π—Å—Ç–≤–∏—è (–æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π, –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞)
**–≠—Ñ—Ñ–µ–∫—Ç:** –ë–æ–ª–µ–µ –æ—Ç–∑—ã–≤—á–∏–≤—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

#### 2.2. Offline –ø–æ–¥–¥–µ—Ä–∂–∫–∞
**–¢–µ–∫—É—â–∞—è –ø—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–∏ –ø–æ—Ç–µ—Ä–µ —Å–µ—Ç–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Service Worker –¥–ª—è –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è
**–≠—Ñ—Ñ–µ–∫—Ç:** –†–∞–±–æ—Ç–∞ –≤ –æ—Ñ—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º–µ

#### 2.3. –£–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
**–¢–µ–∫—É—â–∞—è –ø—Ä–æ–±–ª–µ–º–∞:** –û—à–∏–±–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ –∫–æ–Ω—Å–æ–ª–∏
**–†–µ—à–µ–Ω–∏–µ:** –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
**–≠—Ñ—Ñ–µ–∫—Ç:** –õ—É—á—à–∏–π UX –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö

### 3. **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è**

#### 3.1. –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ –º–æ–¥—É–ª–∏
**–¢–µ–∫—É—â–∞—è –ø—Ä–æ–±–ª–µ–º–∞:** –í–µ—Å—å –∫–æ–¥ –≤ –æ–¥–Ω–æ–º —Ñ–∞–π–ª–µ (6000+ —Å—Ç—Ä–æ–∫)
**–†–µ—à–µ–Ω–∏–µ:** –†–∞–∑–¥–µ–ª–∏—Ç—å –Ω–∞ –º–æ–¥—É–ª–∏ (chat-list.js, chat-messages.js, chat-filters.js)
**–≠—Ñ—Ñ–µ–∫—Ç:** –õ–µ–≥—á–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å

#### 3.2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ TypeScript
**–¢–µ–∫—É—â–∞—è –ø—Ä–æ–±–ª–µ–º–∞:** –ù–µ—Ç —Ç–∏–ø–∏–∑–∞—Ü–∏–∏
**–†–µ—à–µ–Ω–∏–µ:** –ú–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ TypeScript
**–≠—Ñ—Ñ–µ–∫—Ç:** –ú–µ–Ω—å—à–µ –æ—à–∏–±–æ–∫, –ª—É—á—à–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ IDE

#### 3.3. State management
**–¢–µ–∫—É—â–∞—è –ø—Ä–æ–±–ª–µ–º–∞:** –°–æ—Å—Ç–æ—è–Ω–∏–µ —Ä–∞–∑–±—Ä–æ—Å–∞–Ω–æ –ø–æ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º
**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Redux –∏–ª–∏ MobX
**–≠—Ñ—Ñ–µ–∫—Ç:** –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º

## üí° –ù–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

### 1. **–§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤**

#### 1.1. –ú–∞—Å—Å–æ–≤—ã–µ –¥–µ–π—Å—Ç–≤–∏—è
- –ú–∞—Å—Å–æ–≤–æ–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ —á–∞—Ç–æ–≤
- –ú–∞—Å—Å–æ–≤–æ–µ –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏–µ –≤ –ø—É–ª
- –ú–∞—Å—Å–æ–≤–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞
- –ú–∞—Å—Å–æ–≤–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π

#### 1.2. –£–º–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã
- –§–∏–ª—å—Ç—Ä –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –±–µ–∑ –æ—Ç–≤–µ—Ç–∞
- –§–∏–ª—å—Ç—Ä –ø–æ –º–∞–≥–∞–∑–∏–Ω—É
- –§–∏–ª—å—Ç—Ä –ø–æ –º–µ–Ω–µ–¥–∂–µ—Ä—É
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤

#### 1.3. –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö —á–∞—Ç–æ–≤ –∑–∞ –¥–µ–Ω—å/–Ω–µ–¥–µ–ª—é/–º–µ—Å—è—Ü
- –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞
- –ü—Ä–æ—Ü–µ–Ω—Ç –æ—Ç–≤–µ—Ç–æ–≤ –≤ —Ç–µ—á–µ–Ω–∏–µ X –º–∏–Ω—É—Ç
- –ì—Ä–∞—Ñ–∏–∫–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

#### 1.4. –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è
- –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ –Ω–µ–æ—Ç–≤–µ—á–µ–Ω–Ω—ã—Ö —á–∞—Ç–∞—Ö
- –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ –≤–∞–∂–Ω—ã—Ö —á–∞—Ç–∞—Ö
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è —á–µ—Ä–µ–∑ X –º–∏–Ω—É—Ç

### 2. **–§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤**

#### 2.1. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Å–∏—Å—Ç–µ–º—ã
- –ê–ª–µ—Ä—Ç—ã –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö

#### 2.2. –ê–Ω–∞–ª–∏—Ç–∏–∫–∞
- –î–µ—Ç–∞–ª—å–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø–æ —á–∞—Ç–∞–º
- –û—Ç—á–µ—Ç—ã –ø–æ –º–µ–Ω–µ–¥–∂–µ—Ä–∞–º
- –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö

#### 2.3. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–∞–≤–∏–ª –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤ —á–∞—Ç–æ–≤
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞–º–∏ –æ—Ç–≤–µ—Ç–æ–≤

### 3. **–û–±—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏**

#### 3.1. –£–ª—É—á—à–µ–Ω–Ω—ã–π –ø–æ–∏—Å–∫
- –ü–æ–∏—Å–∫ –ø–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–º—É —Å–æ–æ–±—â–µ–Ω–∏–π
- –ü–æ–∏—Å–∫ –ø–æ –∫–ª–∏–µ–Ω—Ç—É
- –ü–æ–∏—Å–∫ –ø–æ –æ–±—ä—è–≤–ª–µ–Ω–∏—é
- –ò—Å—Ç–æ—Ä–∏—è –ø–æ–∏—Å–∫–∞

#### 3.2. –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- –ë—Ä–∞—É–∑–µ—Ä–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–æ–≤—ã—Ö —á–∞—Ç–∞—Ö
- –ó–≤—É–∫–æ–≤—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–∏–ø–æ–≤ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

#### 3.3. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å CRM —Å–∏—Å—Ç–µ–º–∞–º–∏
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–∞–º–∏
- Webhook –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö —Å–∏—Å—Ç–µ–º

#### 3.4. –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –æ—Ç–≤–µ—Ç—ã –Ω–∞ —á–∞—Å—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ —á–∞—Ç–æ–≤ –ø–æ –ø—Ä–∞–≤–∏–ª–∞–º
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ —Å—Ç–∞—Ä—ã—Ö —á–∞—Ç–æ–≤

## üìã –ü–ª–∞–Ω –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã)

### –í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
1. ‚úÖ –ò—Å–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É currentUserId (–º–æ–∂–µ—Ç –±—ã—Ç—å 0) - –ò–°–ü–†–ê–í–õ–ï–ù–û
2. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –±–ª–æ–∫–∏—Ä–æ–≤–∫—É –¥–ª—è batch-take - –ò–°–ü–†–ê–í–õ–ï–ù–û
3. ‚úÖ –í—ã–Ω–µ—Å—Ç–∏ –ø—Ä–æ–≤–µ—Ä–∫—É "–ú–æ–∏ —á–∞—Ç—ã" –≤ —Ñ—É–Ω–∫—Ü–∏—é - –ò–°–ü–†–ê–í–õ–ï–ù–û
4. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ —Å–µ—Ç–∏ - –ò–°–ü–†–ê–í–õ–ï–ù–û
5. ‚úÖ –£–±—Ä–∞—Ç—å –∏–∑–±—ã—Ç–æ—á–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ production - –ò–°–ü–†–ê–í–õ–ï–ù–û (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è DEBUG_MODE)
6. ‚úÖ –ò–Ω–≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å –∫–µ—à –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π - –ò–°–ü–†–ê–í–õ–ï–ù–û
7. ‚úÖ –í—ã–Ω–µ—Å—Ç–∏ –º–∞–≥–∏—á–µ—Å–∫–∏–µ —á–∏—Å–ª–∞ –≤ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã - –ò–°–ü–†–ê–í–õ–ï–ù–û

### –°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
8. –î–æ–±–∞–≤–∏—Ç—å debounce –¥–ª—è –ø–æ–∏—Å–∫–∞ (—á–∞—Å—Ç–∏—á–Ω–æ - –µ—Å—Ç—å –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞, –Ω–æ –Ω—É–∂–Ω–æ –ø—Ä–∏–º–µ–Ω–∏—Ç—å)
9. –î–æ–±–∞–≤–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –æ—á–∏—Å—Ç–∫—É —Å—Ç–∞—Ä—ã—Ö –∑–∞–ø–∏—Å–µ–π –∏–∑ locallyTakenChats
10. –£–ª—É—á—à–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ —Å retry –ª–æ–≥–∏–∫–æ–π

### –ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
11. –†–∞–∑–¥–µ–ª–∏—Ç—å –∫–æ–¥ –Ω–∞ –º–æ–¥—É–ª–∏
12. –î–æ–±–∞–≤–∏—Ç—å –≤–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏—é —Å–ø–∏—Å–∫–∞
13. –î–æ–±–∞–≤–∏—Ç—å offline –ø–æ–¥–¥–µ—Ä–∂–∫—É
14. –ú–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ TypeScript

## üîß –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–¥–∞

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ currentUserId
```javascript
// –ë—ã–ª–æ:
const currentUserId = {% if user and user.id %}{{ user.id }}{% else %}null{% endif %};

// –î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
const currentUserId = {% if user and user.id is not none %}{{ user.id }}{% else %}null{% endif %};
// –ò–ª–∏ –ª—É—á—à–µ:
const currentUserId = {{ user.id if user and user.id is not none else 'null' }};
```

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 2: –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ "–ú–æ–∏ —á–∞—Ç—ã"
```javascript
function isMyChat(chat) {
    if (!chat.assigned_manager_id) return false;
    if (chat.status === 'completed' || chat.status === 'blocked') return false;
    
    const isAssignedById = chat.assigned_manager_id === currentUserId;
    const isAssignedByName = chat.assigned_manager_name === currentUsername ||
        (chat.assigned_manager_name && currentUsername && 
         chat.assigned_manager_name.includes(currentUsername));
    const isLocallyTaken = locallyTakenChats.has(chat.id);
    
    return isAssignedById || isAssignedByName || isLocallyTaken;
}
```

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 3: –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –¥–ª—è batch-take
```javascript
let batchTakeInProgress = false;

async function flushBatchTakeQueue() {
    if (batchTakeInProgress) {
        console.warn('[BATCH TAKE] –£–∂–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º');
        return;
    }
    
    batchTakeInProgress = true;
    try {
        // ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ ...
    } finally {
        batchTakeInProgress = false;
    }
}
```

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 4: –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –≤–º–µ—Å—Ç–æ –º–∞–≥–∏—á–µ—Å–∫–∏—Ö —á–∏—Å–µ–ª
```javascript
const DELAYS = {
    BATCH_TAKE: 2000,           // –ó–∞–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–¥ –æ—á–∏—Å—Ç–∫–æ–π locallyTakenChats
    PRODUCT_URL_EXTRACT: 3000,  // –ó–∞–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–¥ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ–º product_url
    AUTO_EXTRACT: 5000,         // –ó–∞–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–¥ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ–º
    SYNC_RETRY: 1000,           // –ó–∞–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–¥ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –ø–æ–ø—ã—Ç–∫–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
    SEARCH_DEBOUNCE: 300        // Debounce –¥–ª—è –ø–æ–∏—Å–∫–∞
};
```

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 5: –ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –∫–µ—à–∞ - ‚úÖ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û
```javascript
function invalidateChatsCache() {
    localStorage.removeItem(CHATS_CACHE_KEY);
    localStorage.removeItem(CHATS_CACHE_TIMESTAMP_KEY);
    debugLog('[CACHE] –ö–µ—à –∏–Ω–≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞–Ω');
}
```

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 6: –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–ª—è –∑–∞–¥–µ—Ä–∂–µ–∫ - ‚úÖ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û
```javascript
const DELAYS = {
    BATCH_TAKE_CLEANUP: 2000,        // –ó–∞–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–¥ –æ—á–∏—Å—Ç–∫–æ–π locallyTakenChats
    PRODUCT_URL_EXTRACT: 3000,       // –ó–∞–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–¥ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ–º product_url
    AUTO_EXTRACT: 5000,              // –ó–∞–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–¥ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ–º
    SYNC_RETRY: 1000,                // –ó–∞–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–¥ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –ø–æ–ø—ã—Ç–∫–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
    SEARCH_DEBOUNCE: 300             // Debounce –¥–ª—è –ø–æ–∏—Å–∫–∞
};
```

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 7: –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –¥–ª—è batch-take - ‚úÖ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û
```javascript
let batchTakeInProgress = false;

async function flushBatchTakeQueue() {
    if (batchTakeInProgress) {
        console.warn('[BATCH TAKE] –£–∂–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º');
        return;
    }
    batchTakeInProgress = true;
    try {
        // ... –∫–æ–¥ ...
    } finally {
        batchTakeInProgress = false;
    }
}
```

## ‚úÖ –í–´–ü–û–õ–ù–ï–ù–ù–´–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

1. ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ currentUserId (—Ç–µ–ø–µ—Ä—å –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –Ω–∞ `is not none`)
2. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ `batchTakeInProgress` –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è race condition
3. ‚úÖ –í—ã–Ω–µ—Å–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `isMyChat()` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ "–ú–æ–∏ —á–∞—Ç—ã"
4. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `invalidateChatsCache()` –¥–ª—è –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∫–µ—à–∞
5. ‚úÖ –í—ã–Ω–µ—Å–µ–Ω—ã –º–∞–≥–∏—á–µ—Å–∫–∏–µ —á–∏—Å–ª–∞ –≤ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã `DELAYS`
6. ‚úÖ –ó–∞–º–µ–Ω–µ–Ω—ã `console.log` –Ω–∞ `debugLog` —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π `DEBUG_MODE`
7. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –≤ catch –±–ª–æ–∫–µ `flushBatchTakeQueue`
8. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –∫–µ—à–∞ –ø—Ä–∏ –≤–∑—è—Ç–∏–∏/–≤–æ–∑–≤—Ä–∞—Ç–µ —á–∞—Ç–æ–≤
9. ‚úÖ –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ª–æ–∫–∞–ª—å–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å —Å–µ—Ä–≤–µ—Ä–∞
10. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –∑–∞—â–∏—Ç–∞ –æ—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –≤–æ –≤—Ä–µ–º—è –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è —á–∞—Ç–æ–≤

## üéØ –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò

### –ù–µ–º–µ–¥–ª–µ–Ω–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è (–º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å —Å–µ–π—á–∞—Å)

1. **–ü—Ä–∏–º–µ–Ω–∏—Ç—å debounce –¥–ª—è –ø–æ–∏—Å–∫–∞**
   - –ö–æ–Ω—Å—Ç–∞–Ω—Ç–∞ `DELAYS.SEARCH_DEBOUNCE` —É–∂–µ —Å–æ–∑–¥–∞–Ω–∞, –Ω–æ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
   - –ù—É–∂–Ω–æ –æ–±–µ—Ä–Ω—É—Ç—å `handleSearchInput` –≤ debounce —Ñ—É–Ω–∫—Ü–∏—é

2. **–î–æ–±–∞–≤–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –æ—á–∏—Å—Ç–∫—É locallyTakenChats**
   ```javascript
   // –û—á–∏—â–∞—Ç—å —Å—Ç–∞—Ä—ã–µ –∑–∞–ø–∏—Å–∏ (—Å—Ç–∞—Ä—à–µ 5 –º–∏–Ω—É—Ç) –ø—Ä–∏ –∫–∞–∂–¥–æ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏
   setInterval(() => {
       const now = Date.now();
       // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å timestamp –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —á–∞—Ç–∞ –≤ Set
   }, 60000); // –ö–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É
   ```

3. **–£–ª—É—á—à–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ —Å–µ—Ç–∏**
   - –î–æ–±–∞–≤–∏—Ç—å retry —Å exponential backoff
   - –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
   - –°–æ—Ö—Ä–∞–Ω—è—Ç—å –¥–µ–π—Å—Ç–≤–∏—è –≤ –æ—á–µ—Ä–µ–¥—å –ø—Ä–∏ –æ—Ñ—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º–µ

### –°—Ä–µ–¥–Ω–µ—Å—Ä–æ—á–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è (1-2 –Ω–µ–¥–µ–ª–∏)

4. **–î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –¥–∞–Ω–Ω—ã—Ö —Å —Å–µ—Ä–≤–µ—Ä–∞**
   ```javascript
   function validateChatData(chat) {
       return chat && 
              typeof chat.id === 'number' &&
              typeof chat.status === 'string' &&
              (chat.assigned_manager_id === null || typeof chat.assigned_manager_id === 'number');
   }
   ```

5. **–î–æ–±–∞–≤–∏—Ç—å –º–µ–º–æ–∏–∑–∞—Ü–∏—é –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏**
   ```javascript
   const memoizedFilter = memoize((chats, sort, userId, username) => {
       // –ª–æ–≥–∏–∫–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
   }, (chats, sort, userId, username) => 
       `${chats.length}-${sort}-${userId}-${username}`
   );
   ```

6. **–î–æ–±–∞–≤–∏—Ç—å –≤–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏—é —Å–ø–∏—Å–∫–∞**
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–∏–±–ª–∏–æ—Ç–µ–∫—É —Ç–∏–ø–∞ `react-window` –∏–ª–∏ –Ω–∞–ø–∏—Å–∞—Ç—å —Å–≤–æ—é
   - –†–µ–Ω–¥–µ—Ä–∏—Ç—å —Ç–æ–ª—å–∫–æ –≤–∏–¥–∏–º—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã

### –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è (1-2 –º–µ—Å—è—Ü–∞)

7. **–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã**
   - –†–∞–∑–¥–µ–ª–∏—Ç—å –Ω–∞ –º–æ–¥—É–ª–∏ (ES6 modules)
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–∞—Ç—Ç–µ—Ä–Ω MVC –∏–ª–∏ MVVM
   - –î–æ–±–∞–≤–∏—Ç—å unit —Ç–µ—Å—Ç—ã

8. **–ú–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —Å—Ç–µ–∫**
   - –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å React/Vue –¥–ª—è UI
   - TypeScript –¥–ª—è —Ç–∏–ø–∏–∑–∞—Ü–∏–∏
   - Webpack/Vite –¥–ª—è —Å–±–æ—Ä–∫–∏

## üìä –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –¢–µ–∫—É—â–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

1. **–†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –±–æ–ª—å—à–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —á–∞—Ç–æ–≤**
   - –ü—Ä–∏ 1000+ —á–∞—Ç–∞—Ö –º–æ–∂–µ—Ç –±—ã—Ç—å –º–µ–¥–ª–µ–Ω–Ω–æ
   - –†–µ—à–µ–Ω–∏–µ: –≤–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏—è

2. **–ß–∞—Å—Ç—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è DOM**
   - –ö–∞–∂–¥–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—ã–∑—ã–≤–∞–µ—Ç –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–∫—É
   - –†–µ—à–µ–Ω–∏–µ: batch updates, requestAnimationFrame

3. **–ë–æ–ª—å—à–æ–π —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞**
   - 6000+ —Å—Ç—Ä–æ–∫ –≤ –æ–¥–Ω–æ–º —Ñ–∞–π–ª–µ
   - –†–µ—à–µ–Ω–∏–µ: —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ –º–æ–¥—É–ª–∏

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

- –í—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- –í—Ä–µ–º—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ —Å–ø–∏—Å–∫–∞ —á–∞—Ç–æ–≤
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ API
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏
- FPS –ø—Ä–∏ —Å–∫—Ä–æ–ª–ª–∏–Ω–≥–µ

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ù–∞–π–¥–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

1. **XSS –≤ —Å–æ–æ–±—â–µ–Ω–∏—è—Ö**
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `escapeHtml`, –Ω–æ –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ –º–µ—Å—Ç–∞
   - –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å DOMPurify

2. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ rate limiting –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ**
   - –ú–æ–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –º–Ω–æ–∂–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤
   - –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: –¥–æ–±–∞–≤–∏—Ç—å throttling

3. **–•—Ä–∞–Ω–µ–Ω–∏–µ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ localStorage**
   - –ö–µ—à —á–∞—Ç–æ–≤ –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
   - –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –∏–ª–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ —Ö—Ä–∞–Ω–µ–Ω–∏—è

## üìù –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–ö–æ–¥ –≤ —Ü–µ–ª–æ–º —Ö–æ—Ä–æ—à–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω, –Ω–æ –µ—Å—Ç—å –æ–±–ª–∞—Å—Ç–∏ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è:
- ‚úÖ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã
- ‚ö†Ô∏è –°—Ä–µ–¥–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Ç—Ä–µ–±—É—é—Ç –≤–Ω–∏–º–∞–Ω–∏—è
- üí° –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è –¥–ª—è –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç–∏

–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:
1. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –æ—Å—Ç–∞–≤—à–∏–µ—Å—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏–∑ —Å—Ä–µ–¥–Ω–µ–≥–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞
2. –ù–∞—á–∞—Ç—å –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞
3. –î–æ–±–∞–≤–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
4. –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –Ω–∞ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —Å—Ç–µ–∫

## üéÅ –ë–û–ù–£–°: –ì–æ—Ç–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è

### 1. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –∑–∞–ø–∏—Å–µ–π –∏–∑ locallyTakenChats
```javascript
// –î–æ–±–∞–≤–∏—Ç—å –ø–æ—Å–ª–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è locallyTakenChats
setInterval(() => {
    // –û—á–∏—â–∞–µ–º —á–∞—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –±—ã–ª–∏ –≤–∑—è—Ç—ã –±–æ–ª–µ–µ 10 –º–∏–Ω—É—Ç –Ω–∞–∑–∞–¥
    // (–µ—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä –Ω–µ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–ª –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –∑–∞ —ç—Ç–æ –≤—Ä–µ–º—è, –≤–µ—Ä–æ—è—Ç–Ω–æ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫)
    const now = Date.now();
    const MAX_LOCAL_AGE = 10 * 60 * 1000; // 10 –º–∏–Ω—É—Ç
    
    // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å Map –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è timestamp
    // const locallyTakenChatsTimestamps = new Map();
    // –ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏: locallyTakenChatsTimestamps.set(chatId, now);
    // –ü—Ä–∏ –æ—á–∏—Å—Ç–∫–µ: –ø—Ä–æ–≤–µ—Ä—è—Ç—å –≤–æ–∑—Ä–∞—Å—Ç –∏ —É–¥–∞–ª—è—Ç—å —Å—Ç–∞—Ä—ã–µ
}, 60000); // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É
```

### 2. –£–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å retry
```javascript
async function fetchWithRetry(url, options, maxRetries = 3) {
    for (let i = 0; i < maxRetries; i++) {
        try {
            const response = await fetch(url, options);
            if (response.ok) return response;
            if (i === maxRetries - 1) throw new Error(`HTTP ${response.status}`);
        } catch (error) {
            if (i === maxRetries - 1) throw error;
            await new Promise(resolve => setTimeout(resolve, DELAYS.SYNC_RETRY * Math.pow(2, i)));
        }
    }
}
```

### 3. –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
```javascript
let isOnline = navigator.onLine;
window.addEventListener('online', () => {
    isOnline = true;
    showNotification('‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ', 'success');
    loadChats(false, true);
});
window.addEventListener('offline', () => {
    isOnline = false;
    showNotification('‚ö†Ô∏è –ù–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É', 'warning');
});
```

### 4. –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö —á–∞—Ç–∞
```javascript
function validateChatData(chat) {
    if (!chat || typeof chat !== 'object') return false;
    if (typeof chat.id !== 'number' || chat.id <= 0) return false;
    if (typeof chat.status !== 'string') return false;
    if (chat.assigned_manager_id !== null && typeof chat.assigned_manager_id !== 'number') return false;
    return true;
}

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ:
const validChats = items.filter(validateChatData);
if (validChats.length !== items.length) {
    console.warn(`–û—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–æ ${items.length - validChats.length} –Ω–µ–≤–∞–ª–∏–¥–Ω—ã—Ö —á–∞—Ç–æ–≤`);
}
allChats = validChats;
```

### 5. –ú–µ–º–æ–∏–∑–∞—Ü–∏—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
```javascript
function memoize(fn, keyFn) {
    const cache = new Map();
    return function(...args) {
        const key = keyFn ? keyFn(...args) : JSON.stringify(args);
        if (cache.has(key)) return cache.get(key);
        const result = fn(...args);
        cache.set(key, result);
        // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä –∫–µ—à–∞
        if (cache.size > 100) {
            const firstKey = cache.keys().next().value;
            cache.delete(firstKey);
        }
        return result;
    };
}

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:
const memoizedFilter = memoize(
    (chats, sort, userId, username) => {
        // –ª–æ–≥–∏–∫–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
    },
    (chats, sort, userId, username) => 
        `${chats.length}-${sort}-${userId}-${username}`
);
```

